# ProjectMeats3 - User Deployment Guide
## üöÄ Simple Step-by-Step Digital Ocean Deployment

This guide gets your ProjectMeats3 application running on Digital Ocean App Platform in under 30 minutes.

## Prerequisites Checklist ‚úÖ
- [ ] Digital Ocean account with billing enabled
- [ ] GitHub account access to Meats-Central/ProjectMeats3
- [ ] Domain name (optional - Digital Ocean provides one)
- [ ] 30 minutes of time

---

## üéØ Quick Start Checklist

### Step 1: Digital Ocean Setup (5 minutes)
- [ ] **Create Digital Ocean Account**: Visit https://cloud.digitalocean.com/
- [ ] **Generate API Token**: 
  - Go to API ‚Üí Personal Access Tokens
  - Create new token with read/write permissions
  - Copy token (you'll need this for GitHub)

### Step 2: Environment Configuration (10 minutes)
- [ ] **Set Up Production Environment**:
  ```bash
  # Clone the repository locally (if not already done)
  git clone https://github.com/Meats-Central/ProjectMeats3.git
  cd ProjectMeats3
  
  # Set up production environment
  python config/manage_env.py setup production
  
  # Generate secure secrets
  python config/manage_env.py generate-secrets
  ```
- [ ] **Copy the generated secrets** - you'll need them for Digital Ocean

### Step 3: GitHub Repository Setup (5 minutes)
- [ ] **Add Digital Ocean Token to GitHub**:
  - Go to your GitHub repository ‚Üí Settings ‚Üí Secrets and Variables ‚Üí Actions
  - Add new secret: `DIGITALOCEAN_ACCESS_TOKEN` = your_digital_ocean_api_token

### Step 4: Digital Ocean App Creation (10 minutes)
- [ ] **Create New App in Digital Ocean**:
  - Go to Digital Ocean Dashboard ‚Üí Apps ‚Üí Create App
  - Connect GitHub repository: `Meats-Central/ProjectMeats3`
  - Upload the `app.yaml` file from repository root
  - Configure environment variables (see section below)
  - Click Deploy

#### Required Environment Variables:
Add these in the Digital Ocean App settings:

**Backend Service (api)**:
```
SECRET_KEY=your-generated-production-secret-key
ADMIN_URL=admin/  (or your custom secure path)
EMAIL_HOST=smtp.gmail.com  (optional)
EMAIL_HOST_USER=your-email@gmail.com  (optional)
EMAIL_HOST_PASSWORD=your-app-password  (optional)
```

**Frontend Service (web)**:
No manual configuration needed - automatically set by app.yaml

### Step 5: Post-Deployment Verification (5 minutes)
- [ ] **Wait for Deployment**: Monitor in Digital Ocean dashboard (~5-10 minutes)
- [ ] **Create Admin User**: 
  - Go to Digital Ocean ‚Üí Your App ‚Üí api service ‚Üí Console
  - Run: `python manage.py createsuperuser`
- [ ] **Test Application**:
  - Visit your app URL (provided by Digital Ocean)
  - Test health check: `https://your-app.ondigitalocean.app/api/v1/health/`
  - Test admin access: `https://your-app.ondigitalocean.app/admin/`
  - Test frontend: `https://your-app.ondigitalocean.app/`

---

## ‚úÖ Success! Your App is Live

üéâ **You're done!** Your ProjectMeats3 application is now running on Digital Ocean.

**Your URLs:**
- **Frontend**: https://your-app.ondigitalocean.app/
- **API**: https://your-app.ondigitalocean.app/api/v1/
- **Admin**: https://your-app.ondigitalocean.app/admin/

---

## üîß Optional: Nice-to-Have Features

These features enhance your deployment but are not required for basic functionality:

### Custom Domain Setup
- [ ] **Add Custom Domain**: In Digital Ocean App settings ‚Üí Domains
- [ ] **Update DNS Records**: Point your domain to Digital Ocean
- [ ] **SSL Certificate**: Auto-generated by Digital Ocean

### Enhanced Email Configuration
- [ ] **Gmail App Password**: Create app-specific password for Gmail
- [ ] **AWS SES**: Set up professional email service
- [ ] **Email Templates**: Customize notification emails

### Monitoring & Alerts
- [ ] **Uptime Monitoring**: Set up Digital Ocean monitoring alerts
- [ ] **Log Management**: Configure log retention and alerts
- [ ] **Performance Monitoring**: Add APM tools (optional)

### Security Enhancements
- [ ] **Custom Admin URL**: Change from `/admin/` to something secure
- [ ] **Rate Limiting**: Configure API rate limits
- [ ] **Backup Strategy**: Set up automated database backups

### Development Workflow
- [ ] **Staging Environment**: Create staging app for testing
- [ ] **Branch Protection**: Set up GitHub branch protection rules
- [ ] **Code Quality**: Enable automated code quality checks

---

## üö® Troubleshooting

**App Spec Upload Failed?**
1. **"unknown field 'certificate_id'" error**: Use the latest `app.yaml` from the repository (recently fixed)
2. **Parsing errors**: Ensure you're uploading the `app.yaml` file from the repository root
3. **Validation failed**: Check that your Digital Ocean CLI is up to date

**Build Failed?**
1. Check build logs in Digital Ocean App dashboard
2. Verify all environment variables are set
3. Ensure repository has latest changes

**App Won't Start?**
1. Check runtime logs in Digital Ocean
2. Verify database connection
3. Test health endpoint: `/api/v1/health/`

**Frontend Not Loading?**
1. Verify backend is running first
2. Check CORS settings in environment variables
3. Clear browser cache

**Need Help?**
1. Check detailed logs in Digital Ocean dashboard
2. Review environment configuration: `python config/manage_env.py validate`
3. Create issue in GitHub repository

---

---

## üèóÔ∏è Alternative: Infrastructure as Code (IaC) with Terraform

For advanced users who want more control over their infrastructure, you can use Terraform to provision DigitalOcean Droplets and managed databases instead of using the App Platform approach above.

### Why Use IaC with Terraform?

**Benefits:**
- **Full Control**: Manage VMs, databases, networking, and security
- **Repeatability**: Recreate identical environments 
- **Version Control**: Track infrastructure changes in Git
- **Cost Optimization**: Fine-tune resource sizes and configurations
- **Automation**: Integrate with CI/CD pipelines

**Use Cases:**
- Advanced networking requirements
- Custom server configurations  
- Multi-region deployments
- Integration with existing infrastructure

### Prerequisites for IaC Deployment ‚úÖ
- [ ] DigitalOcean account with API access
- [ ] Terraform installed (v1.0+)
- [ ] SSH key added to DigitalOcean
- [ ] Basic Terraform knowledge

### IaC Deployment Steps

#### Step 1: Install Terraform (5 minutes)
```bash
# Download and install Terraform
# macOS
brew tap hashicorp/tap
brew install hashicorp/tap/terraform

# Linux
curl -fsSL https://releases.hashicorp.com/terraform/1.6.0/terraform_1.6.0_linux_amd64.zip -o terraform.zip
unzip terraform.zip && sudo mv terraform /usr/local/bin/

# Windows
# Download from https://developer.hashicorp.com/terraform/downloads

# Verify installation
terraform version
```

#### Step 2: Configure DigitalOcean Access (5 minutes)
- [ ] **Generate DigitalOcean API Token**: 
  - Go to DigitalOcean Dashboard ‚Üí API ‚Üí Personal Access Tokens
  - Create new token with **read/write** permissions
- [ ] **Add SSH Key to DigitalOcean**:
  - Go to DigitalOcean Dashboard ‚Üí Settings ‚Üí Security ‚Üí SSH Keys
  - Add your public SSH key and note the Key ID
- [ ] **Set Environment Variables**:
  ```bash
  export TF_VAR_do_token="your-digitalocean-api-token"
  export TF_VAR_ssh_key_id="your-ssh-key-id"
  ```

#### Step 3: Choose Your Environment (2 minutes)
Navigate to the appropriate environment directory:
```bash
cd infrastructure/environments/dev     # Development environment
cd infrastructure/environments/staging # Staging environment  
cd infrastructure/environments/prod    # Production environment
```

#### Step 4: Deploy Infrastructure (10 minutes)
```bash
# Initialize Terraform
terraform init

# Preview changes
terraform plan -var-file=dev.tfvars  # or staging.tfvars/prod.tfvars

# Apply configuration
terraform apply -var-file=dev.tfvars -auto-approve
```

#### Step 5: Configure Application (10 minutes)
After Terraform completes, you'll get outputs with server details:
```bash
# Get server IP and database connection info
terraform output

# SSH to your server
ssh root@<droplet-ip>

# Configure database connection in /app/.env
cd /app
cat >> .env << EOF
DATABASE_URL=postgresql://user:password@db-host:25060/meats_db?sslmode=require
EOF

# Start the application
./start_app.sh
```

#### Step 6: Verify Deployment (5 minutes)
- [ ] **Test Application**: Visit `http://<droplet-ip>:3000`
- [ ] **Test API**: Visit `http://<droplet-ip>:8000/api/v1/health/`
- [ ] **Test Admin**: Visit `http://<droplet-ip>:8000/admin/`

### IaC Environment Configurations

| Environment | Droplet Size | Database | Use Case |
|-------------|--------------|-----------|-----------|
| **Development** | 1 vCPU, 1GB RAM | Single node | Testing, development |
| **Staging** | 1 vCPU, 2GB RAM | Single node | Pre-production testing |
| **Production** | 2 vCPU, 4GB RAM | 2-node cluster | Production workloads |

### IaC Management Commands

```bash
# View current state
terraform show

# Update infrastructure
terraform plan -var-file=<env>.tfvars
terraform apply -var-file=<env>.tfvars

# Destroy infrastructure (be careful!)
terraform destroy -var-file=<env>.tfvars

# Get outputs
terraform output
terraform output -json
```

### IaC vs App Platform Comparison

| Feature | IaC (Terraform) | App Platform |
|---------|------------------|---------------|
| **Complexity** | Advanced | Simple |
| **Control** | Full control | Managed service |
| **Setup Time** | 30-45 minutes | 15-30 minutes |
| **Maintenance** | Manual updates | Auto-managed |
| **Cost** | $20-35/month | $20-27/month |
| **Scalability** | Manual scaling | Auto-scaling |
| **Best For** | Custom requirements | Quick deployment |

### Troubleshooting IaC Deployment

**Terraform Init Failed?**
1. Check internet connection and Terraform installation
2. Verify DigitalOcean provider accessibility

**Plan/Apply Failed?**
1. Verify API token has correct permissions
2. Check SSH key exists in DigitalOcean account
3. Ensure environment variables are set correctly

**Application Won't Start?**
1. SSH to droplet and check `/var/log/cloud-init.log`
2. Verify database connection string in `/app/.env`
3. Check Docker services: `docker-compose ps`

**Need to Clean Up?**
```bash
# Destroy all resources (careful!)
terraform destroy -var-file=<env>.tfvars -auto-approve
```

---

## üí∞ Cost Estimate
- **Basic App**: $5-12/month (suitable for development and light usage)
- **Managed Database**: $15/month (PostgreSQL with backups)
- **Total**: ~$20-27/month

---

**That's it!** Your ProjectMeats3 application is deployed and ready for production use. The entire process should take about 30 minutes from start to finish.